<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <title>Memory Handoff Hub</title>
  <style>
    body { font-family: sans-serif; margin: 20px; background-color: #f4f4f4; }
    textarea { width: 95%; height: 250px; margin-bottom: 10px; }
    button { padding: 10px 15px; background-color: #007BFF; color: white; border: none; cursor: pointer; }
    #status { margin-top: 15px; font-weight: bold; }
    .doc-link { margin-top: 20px; }
  </style>
</head>
<body>
  <h2>ğŸ§  Memory Handoff Hub (v2.2)</h2>
  
  <p>Gemini/ChatGPTì—ì„œ ìƒì„±í•œ [HANDOFF] ë¸”ë¡ì„ ì•„ë˜ì— ë¶™ì—¬ë„£ê³  [GDocì— ì €ì¥] ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.</p>
  
  <textarea id="handoffText" placeholder="[HANDOFF]... ë¸”ë¡ì„ ì—¬ê¸°ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”..."></textarea>
  <br>
  <button onclick="saveHandoff()">GDocì— ì €ì¥</button>
  <button onclick="openDoc()">ë¬¸ì„œ ì—´ê¸°</button>
  
  <div id="status"></div>
  <div class="doc-link"><a id="docLink" href="#" target="_blank"></a></div>

  <script>
    // í˜ì´ì§€ ë¡œë“œ ì‹œ GDoc ì •ë³´ ê°€ì ¸ì˜¤ê¸° (Cë‹˜ì˜ getDocInfo() í˜¸ì¶œ)
    document.addEventListener("DOMContentLoaded", function() {
      google.script.run.withSuccessHandler(function(info) {
        document.getElementById("docLink").href = info.url;
        document.getElementById("docLink").innerText = "Â» " + info.name + " ì—´ê¸°";
      }).getDocInfo();
    });

    // í•¸ë“œì˜¤í”„ ì €ì¥ (Cë‹˜ì˜ doPost() í˜¸ì¶œ)
    function saveHandoff() {
      document.getElementById("status").innerText = "ì €ì¥ ì¤‘...";
      var text = document.getElementById("handoffText").value;
      
      // v2.2 ë³´ì•ˆ: Apps Scriptì˜ API í† í°ì„ ì—¬ê¸°ì„œ ê°€ì ¸ì™€ì•¼ í•©ë‹ˆë‹¤.
      // (ì´ ì˜ˆì œëŠ” í¸ì˜ìƒ UIì—ì„œ í† í°ì„ ì…ë ¥ë°›ëŠ” ê²ƒì„ ìƒëµí–ˆìŠµë‹ˆë‹¤)
      // (ì‹¤ì œ ìš´ì˜ ì‹œì—ëŠ” UI ë¡œê·¸ì¸/í† í° ê´€ë¦¬ ê¸°ëŠ¥ì´ í•„ìš”í•©ë‹ˆë‹¤)
      
      // Cë‹˜ì˜ `doPost`ëŠ” `text/plain`ì„ ë°›ìœ¼ë¯€ë¡œ `google.script.run` ëŒ€ì‹ 
      // `fetch`ë¥¼ ì‚¬ìš©í•´ URLë¡œ POST ìš”ì²­ì„ ë³´ë‚´ëŠ” ê²ƒì´ ë” í‘œì¤€ì ì…ë‹ˆë‹¤.
      // (ë‹¨, ì´ ì˜ˆì œëŠ” `google.script.run`ì„ ì‚¬ìš©í•œ ê°„í¸ ë²„ì „ì…ë‹ˆë‹¤.)

      // Cë‹˜ì˜ `appendHandoff` í•¨ìˆ˜ë¥¼ ì„œë²„ì‚¬ì´ë“œì—ì„œ ì§ì ‘ í˜¸ì¶œí•©ë‹ˆë‹¤.
      // (ì´ ë°©ì‹ì€ ë³´ì•ˆ í† í°(SECRET) ê²€ì‚¬ë¥¼ ìš°íšŒí•˜ë¯€ë¡œ, UI ì „ìš©ì…ë‹ˆë‹¤.)
      google.script.run
        .withSuccessHandler(function(response) {
          document.getElementById("status").innerText = "âœ… ì €ì¥ ì„±ê³µ! (Status: " + response.status + ")";
          document.getElementById("handoffText").value = ""; // ì…ë ¥ì°½ ë¹„ìš°ê¸°
        })
        .withFailureHandler(function(err) {
          document.getElementById("status").innerText = "âŒ ì €ì¥ ì‹¤íŒ¨: " + err.message;
        })
        .appendHandoff(text); // `doPost` ëŒ€ì‹  `appendHandoff` ì§ì ‘ í˜¸ì¶œ
    }

    function openDoc() {
      window.open(document.getElementById("docLink").href);
    }
  </script>
</body>
</html>